{
    "version": "0.0.1",
    "discoveryPort": {
      "name": "CFR customer data 10-01-22",
      "description": "A daliy updated product about CRF customer data. It consist of more than 20M records integrated from 5 different sources",
      "category": "customer",
      "image": null,
      "autofillUserinfo": true,
      "tags": [],
      "extra": {}
    },
    "inputPorts": [
      {
        "alias": "usersS3_input_port",
        "description": "string",
        "tags": [],
        "extra": {},
        "syncType": "pull",
        "type": "s3",
        "sourceUrn": "urn:dv:datasource:crf-customers-6d4714c3",
        "entityId": {
          "alias": "usersS3",
          "createEntity": true,
          "type": "s3-bucket",
          "entityPath": "s3a://dp-input-bucket/test/userdata1.parquet",
          "entityFilterPatternMatch": "*",
          "sourceSchemaUrn": "urn:dv:schema:9d4716d4",
          "projectSchemaUrn": "urn:dv:schema:9d4716d6",
          "fileFormat": "parquet",
          "delimiter": "|",
          "filter": "country = 'Brazil' and gender is not null and gender != ''",
          "processingTimeColumn": [
            "processing_time"
          ],
          "actualTimeColumn": [
            "processing_time"
          ],
          "projection": [
            "gender"
          ]
        }
      }
    ],
    "stateManagement": {
      "alias": "users_count_by_gender",
      "refreshInterval": "00 10 * * *",
      "logicalSchemaUrn": "${urn:dv:schema:9d4716c3}",
      "retentionVersions": "10",
      "updateStrategy": "SCD-2",
      "productStoreState": {
        "logicalSchemaUrn": "${urn:dv:schema:9d4716c3}",
        "retentionVersions": "10"
      },
      "updateStrategyOptions": [
        {
          "entityRef": "${urn:dv:datasource:6d4714c3}:1",
          "uniqueKeyColumns": [
            "customer_id"
          ],
          "changeTrackColumns": [
            "cust_title_desc",
            "cust_birthday",
            "cust_nationality"
          ]
        }
      ]
    },
    "transformation": {
      "sql": "select gender, count(gender) as gender_count from usersS3 group by gender order by gender asc"
    }
  },
  "productResolutionInfo": {
    "inputPorts": {
      "sourceDetails": [
        {
          "alias": "usersS3_input_port",
          "sourceUrn": "urn:dv:datasource:crf-customers-6d4714c3",
          "connectionProperties": {
            "s3": {
              "accessKeyId": "${env_datasource_crf-customers-6d4714c3_accessKeyId}",
              "secretAccessKey": "${env_datasource_crf-customers-6d4714c3_secretAccessKey}",
              "region": "eu-west-1"
            }
          }
        }
      ]
    },
    "stateManagement": {
      "logicalSchema": {
        "logicalSchemaUrn": "${urn:dv:schema:9d4716c3}",
        "schemaDefinition": {
          "properties": {
            "customerAccountId": {
              "type": "string",
              "description": "",
              "properties": {},
              "maxLength": 0
            },
            "customer_id": {
              "type": "string",
              "description": "",
              "properties": {},
              "maxLength": 60
            },
            "title": {
              "type": "string",
              "description": "",
              "properties": {},
              "maxLength": 40
            },
            "dateOfBirth": {
              "type": "string",
              "description": "",
              "properties": {}
            },
            "nationality": {
              "type": "string",
              "description": "",
              "properties": {}
            },
            "phone": {
              "type": "string",
              "description": "",
              "properties": {}
            }
          },
          "required": [
            "product_name",
            "product_key"
          ]
        }
      }
    },
    "transformation": {
      "language": "sql",
      "env": "spark",
      "dependencyLibs": []
    }
  }
